---
title: "astro.configå†…ã§ç’°å¢ƒå¤‰æ•°ã‚’ä½¿ã†"
emoji: "ğŸ¦’"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["astro", "vite", "cloudflareworkers"]
published: false
---

## ã¯ã˜ã‚ã«

ãƒ­ãƒ¼ã‚«ãƒ«ã§ã¯ã€staticãƒ“ãƒ«ãƒ‰ã€‚Cloudflare Workersã§ã¯serverãƒ“ãƒ«ãƒ‰ã—ãŸã„ã€‚ã¨ã„ã†è¦ä»¶ã‚’å¶ãˆã‚‹ãƒ†ã‚¯ãƒ‹ãƒƒã‚¯ã§ã™ã€‚
cloudflare workesã®ãƒ“ãƒ«ãƒ‰ã‚³ãƒãƒ³ãƒ‰ã«`npm astro --config astro.config.cf.mjs build`ã¨ã™ã‚Œã°ä½•ã‚‚é¢å€’ãªã“ã¨ã¯å¿…è¦ãªã‹ã£ãŸã®ã§ã™ãŒã€ä¸€ã¤ã®configãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç’°å¢ƒæ¯ã«åˆ†å²ã•ã›ãŸã„ã¨è€ƒãˆã€ç’°å¢ƒå¤‰æ•°ã‚’ä½¿ã†ã“ã¨ã«ã‚ˆã£ã¦åˆ†å²ã•ã›ã‚‹ã“ã¨ã«æˆåŠŸã—ãŸãŸã‚ã€ãƒ–ãƒ­ã‚°ã¨ã—ã¦æ®‹ã—ã¦ãŠãã¾ã™ã€‚

https://docs.astro.build/en/reference/cli-reference/#--config-path

## çµè«–

`pnpm i -D vite`ã—ã¦`import.meta.env.HOGE`ã‚’ä½¿ã„ã¾ã—ã‚‡ã†ã€‚

ä»¥é™ã¯èª¿æŸ»ãƒ­ã‚°ã¨ãªã‚‹ã®ã§ã€èˆˆå‘³ã®ã‚ã‚‹æ–¹ã ã‘èª­ã‚“ã§ã„ãŸã ã‘ã‚Œã°ã¨æ€ã„ã¾ã™ã€‚
ãƒ“ãƒ«ãƒ‰çµæœã®ã¿ã‚’ç¢ºèªã—ãŸã„æ–¹ã¯[ã“ã¡ã‚‰](#%E3%83%93%E3%83%AB%E3%83%89)ã‹ã‚‰ã©ã†ã

ä»Šå›ã®ã‚µãƒ³ãƒ—ãƒ«ã‚³ãƒ¼ãƒ‰ã¯ä»¥ä¸‹ã®ãƒ¬ãƒã‚¸ãƒˆãƒªã§å…¬é–‹ã—ã¦ã„ã¾ã™ã€‚

https://github.com/staticWagomU/astro-config-env-var


## Astroã§ä½¿ãˆã‚‹ç’°å¢ƒå¤‰æ•°ã¸ã®ã‚¢ã‚¯ã‚»ã‚¹æ–¹æ³•

astroã§ã¯ç’°å¢ƒå¤‰æ•°ã‚’ã«ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹è¡“ãŒã„ãã¤ã‹ã‚ã‚Šã¾ã™

https://docs.astro.build/en/guides/environment-variables/#in-the-astro-config-file

https://docs.astro.build/en/guides/environment-variables/#vites-built-in-support

### process.env.HOGE
### import.meta.env.HOGE
### astro:env


## èª¿æŸ»

### ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—

```shell
pnpm create cloudflare@latest --framework=astro --platform=workers
```

:::details ã‚³ãƒãƒ³ãƒ‰å®Ÿè¡Œçµæœ
```
> pnpm create cloudflare@latest --framework=astro --platform=workers

.../19662dbdc5c-193486                   |   +1 +
.../19662dbdc5c-193486                   | Progress: resolved 1, reused 0, downloaded 1, added 1, done

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
ğŸ‘‹ Welcome to create-cloudflare v2.45.1!
ğŸ§¡ Let's get started.
ğŸ“Š Cloudflare collects telemetry about your usage of Create-Cloudflare.

Learn more at: https://github.com/cloudflare/workers-sdk/blob/main/packages/create-cloudflare/telemetry.md
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

â•­ Create an application with Cloudflare Step 1 of 3
â”‚
â”œ In which directory do you want to create your application?
â”‚ dir ./astro-config-env-var
â”‚
â”œ What would you like to start with?
â”‚ category Framework Starter
â”‚
â”œ Which development framework do you want to use?
â”‚ framework Astro
â”‚
â”œ Select your deployment platform
â”‚ platform Workers with Assets
â”‚
â”œâ€ŠContinue with Astro via `pnpm dlx create-astro@4.11.2 astro-config-env-var --no-install`
â”‚

Packages: +30
++++++++++++++++++++++++++++++
Progress: resolved 30, reused 29, downloaded 1, added 30, done
 astro   Launch sequence initiated.

      â—¼  dir Using astro-config-env-var as project directory

  tmpl   How would you like to start your new project?
         A basic, helpful starter project
      â—¼  No problem! Remember to install dependencies after setup.

   git   Initialize a new git repository?
         No
      â—¼  Sounds good! You can always run git init manually.

      âœ”  Project initialized!
         â–  Template copied

  next   Liftoff confirmed. Explore your project!

         Enter your project directory using cd ./astro-config-env-var
         Run pnpm dev to start the dev server. CTRL+C to stop.
         Add frameworks like react or tailwind using astro add.

         Stuck? Join us at https://astro.build/chat

â•­â”€â”€â”€â”€â”€â•®  Houston:
â”‚ â—  â—¡ â—   Good luck out there, astronaut! ğŸš€
â•°â”€â”€â”€â”€â”€â•¯
â”œ Copying template files
â”‚ files copied to project directory
â”‚
â”œ Installing dependencies
â”‚ installed via `pnpm install`
â”‚
â•° Application created

â•­ Configuring your application for Cloudflare Step 2 of 3
â”‚
â”œ Installing wrangler A command line tool for building Cloudflare Workers
â”‚ installed via `pnpm install wrangler --save-dev`
â”‚
â”œ Installing @cloudflare/workers-types
â”‚ installed via pnpm
â”‚
â”œ Adding latest types to `tsconfig.json`
â”‚ added @cloudflare/workers-types/2023-07-01
â”‚
â”œ Retrieving current workerd compatibility date
â”‚ compatibility date 2025-04-23
â”‚
â”œ Installing adapter
â”‚ installed via `pnpm astro add cloudflare`
â”‚
â”œâ€ŠUpdating configuration in astro.config.mjs
â”‚
â”œ Adding Wrangler files to the .gitignore file
â”‚ updated .gitignore file
â”‚
â”œ Updating `package.json` scripts
â”‚ updated `package.json`
â”‚
â”œ Do you want to use git for version control?
â”‚ yes git
â”‚
â”œ Initializing git repo
â”‚ initialized git
â”‚
â”œ Committing new files
â”‚ git commit
â”‚
â•° Application configured

â•­ Deploy with Cloudflare Step 3 of 3
â”‚
â”œ Do you want to deploy your application?
â”‚ no deploy via `pnpm run deploy`
â”‚
â•° Done

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
ğŸ‰  SUCCESS  Application created successfully!

ğŸ’» Continue Developing
Change directories: cd astro-config-env-var
Start dev server: pnpm run dev
Deploy: pnpm run deploy

ğŸ“– Explore Documentation
https://developers.cloudflare.com/workers

ğŸ› Report an Issue
https://github.com/cloudflare/workers-sdk/issues/new/choose

ğŸ’¬ Join our Community
https://discord.cloudflare.com
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
```
:::

### å¿…è¦ãªãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

`process.env.HOGE`ã‚’ä½¿ã†ãŸã‚ã«`@types/node`ã‚’ã€`import.meta.env.HOGE`ã‚’ä½¿ã†ãŸã‚ã«`vite`ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

```shell
pnpm i -D @types/node vite
```

### workersã‚’ä½œæˆ


![](Pasted%20image%2020250423232208.png)

![](Pasted%20image%2020250423232311.png)
![](Pasted%20image%2020250423232348.png)

### ãƒ“ãƒ«ãƒ‰

#### cludflare workers

::: details ãƒ­ã‚°
```
Initializing build environment...
Success: Finished initializing build environment
Cloning repository...
Detected the following tools from environment: pnpm@9.10.0, nodejs@22.9.0
Installing project dependencies: pnpm install --frozen-lockfile
! The local project doesn't define a 'packageManager' field. Corepack will now add one referencing pnpm@9.10.0+sha512.73a29afa36a0d092ece5271de5177ecbf8318d454ecd701343131b8ebc0c1a91c487da46ab77c8e596d6acf1461e3594ced4becedf8921b074fbd8653ed7051c.
! For more details about this field, consult the documentation at https://nodejs.org/api/packages.html#packagemanager

Lockfile is up to date, resolution step is skipped
Progress: resolved 1, reused 0, downloaded 0, added 0
Packages: +386
++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++++
Progress: resolved 386, reused 0, downloaded 24, added 24
Progress: resolved 386, reused 0, downloaded 56, added 52
Progress: resolved 386, reused 0, downloaded 132, added 131
Progress: resolved 386, reused 0, downloaded 227, added 227
Progress: resolved 386, reused 0, downloaded 321, added 315
Progress: resolved 386, reused 0, downloaded 382, added 382
Progress: resolved 386, reused 0, downloaded 383, added 382
Progress: resolved 386, reused 0, downloaded 386, added 386, done
.../esbuild@0.25.2/node_modules/esbuild postinstall$ node install.js
.../esbuild@0.24.2/node_modules/esbuild postinstall$ node install.js
.../node_modules/workerd postinstall$ node install.js
.../sharp@0.33.5/node_modules/sharp install$ node install/check
.../esbuild@0.25.2/node_modules/esbuild postinstall: Done
.../esbuild@0.24.2/node_modules/esbuild postinstall: Done
.../node_modules/workerd postinstall: Done
.../sharp@0.33.5/node_modules/sharp install: Done

dependencies:
+ @astrojs/check 0.9.4
+ @astrojs/cloudflare 12.4.1
+ astro 5.6.2
+ typescript 5.8.3

devDependencies:
+ @cloudflare/workers-types 4.20250414.0
+ @types/node 22.14.1
+ vite 6.2.6
+ wrangler 4.10.0

Done in 8.6s
Executing user build command: pnpm run build

> astro-workers-env@0.0.1 build /opt/buildhome/repo
> wrangler types && astro check && astro build


 â›…ï¸ wrangler 4.10.0 (update available 4.12.1)
---------------------------------------------

Generating project types...

declare namespace Cloudflare {
	interface Env {
		VITE_STATIC: "false";
		NODE_VERSION: "22.3.0";
		PNPM_VERSION: "9.12.3";
		ASSETS: Fetcher;
	}
}
interface Env extends Cloudflare.Env {}
type StringifyValues<EnvType extends Record<string, unknown>> = {
	[Binding in keyof EnvType]: EnvType[Binding] extends string ? EnvType[Binding] : string;
};
declare namespace NodeJS {
	interface ProcessEnv extends StringifyValues<Pick<Cloudflare.Env, "VITE_STATIC" | "NODE_VERSION" | "PNPM_VERSION">> {}
}

Generating runtime types...

Runtime types generated.


âœ¨ Types written to worker-configuration.d.ts

Action required Migrate from @cloudflare/workers-types to generated runtime types
`wrangler types` now generates runtime types and supersedes @cloudflare/workers-types.
You should now uninstall @cloudflare/workers-types and remove it from your tsconfig.json.

ğŸ“– Read about runtime types
https://developers.cloudflare.com/workers/languages/typescript/#generate-types
ğŸ“£ Remember to rerun 'wrangler types' after you change your wrangler.json file.


========== astro.config.js ==========
 import.meta.env.VITE_STATIC : false
 process.env.VITE_STATIC     : false
 ======================================
23:51:57 [WARN] [config] The adapter @astrojs/cloudflare has limited support for "sharp". Certain features may not work as expected.
23:51:57 [WARN] [adapter] Cloudflare does not support sharp. You can use the `compile` image service to compile images at build time. It will not work for any on-demand rendered images.
23:51:57 [content] Syncing content
23:51:57 [content] Synced content
23:51:57 [types] Generated 142ms
23:51:57 [check] Getting diagnostics for Astro files in /opt/buildhome/repo...
astro.config.mjs:2:1 - warning ts(6133): 'envField' is declared but its value is never read.

2 import { envField } from 'astro/config';
  ~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Result (6 files): 
- 0 errors
- 0 warnings
- 1 hint


========== astro.config.js ==========
 import.meta.env.VITE_STATIC : false
 process.env.VITE_STATIC     : false
 ======================================
23:52:02 [WARN] [config] The adapter @astrojs/cloudflare has limited support for "sharp". Certain features may not work as expected.
23:52:02 [WARN] [adapter] Cloudflare does not support sharp. You can use the `compile` image service to compile images at build time. It will not work for any on-demand rendered images.
23:52:02 [content] Syncing content
23:52:02 [content] Synced content
23:52:02 [types] Generated 34ms
23:52:02 [build] output: "server"
23:52:02 [build] mode: "server"
23:52:02 [build] directory: /opt/buildhome/repo/dist/
23:52:02 [build] adapter: @astrojs/cloudflare
23:52:02 [build] Collecting build info...
23:52:02 [build] âœ“ Completed in 51ms.
23:52:02 [build] Building server entrypoints...
23:52:03 [vite] âœ“ built in 1.13s
23:52:03 [build] âœ“ Completed in 1.16s.

 prerendering static routes 
23:52:03 âœ“ Completed in 9ms.

23:52:03 [build] Rearranging server assets...
23:52:03 [build] Server built in 1.23s
23:52:03 [build] Complete!
Success: Build command completed
Executing user deploy command: npx wrangler deploy

Cloudflare collects anonymous telemetry about your usage of Wrangler. Learn more at https://github.com/cloudflare/workers-sdk/tree/main/packages/wrangler/telemetry.md

 â›…ï¸ wrangler 4.10.0 (update available 4.12.1)
---------------------------------------------

â–² [WARNING] You are about to publish a Workers Service that was last published via the Cloudflare Dashboard.

  Edits that have been made via the dashboard will be overridden by your local code and config.


? Would you like to continue?
ğŸ¤– Using fallback value in non-interactive context: yes
ğŸŒ€ Building list of assets...
ğŸŒ€ Starting asset upload...
No files to upload. Proceeding with deployment...
Total Upload: 338.71 KiB / gzip: 84.52 KiB
Worker Startup Time: 33 ms
Your worker has access to the following bindings:
- Assets:
  - Binding: ASSETS
Uploaded etude-astro-workers-env (8.08 sec)
Deployed etude-astro-workers-env triggers (0.72 sec)
  https://etude-astro-workers-env.wagomu-dev-th.workers.dev
Current Version ID: 8ee05119-d279-4c5c-8e30-c35f7171e151
Success: Deploy command completed
âœ¨ Success! Build completed.
```
:::

![](Pasted%20image%2020250423232807.png)

#### local

::: details ãƒ­ã‚°
```
> pnpm run build

> astro-config-env-var@0.0.1 build /home/beige/dev/github.com/staticWagomU/astro-config-env-var
> astro build


========== astro.config.js ==========
 import.meta.env.VITE_STATIC : true
 process.env.VITE_STATIC     : undefined
 ======================================
23:25:45 [content] Syncing content
23:25:45 [content] Synced content
23:25:45 [types] Generated 128ms
23:25:45 [build] output: "static"
23:25:45 [build] mode: "static"
23:25:45 [build] directory: /home/beige/dev/github.com/staticWagomU/astro-config-env-var/dist/
23:25:45 [build] Collecting build info...
23:25:45 [build] âœ“ Completed in 143ms.
23:25:45 [build] Building static entrypoints...
23:25:46 [vite] âœ“ built in 701ms
23:25:46 [build] âœ“ Completed in 748ms.

 generating static routes
23:25:46 â–¶ src/pages/index.astro
23:25:46   â””â”€ /index.html
========== index.astro ==========
 import.meta.env.VITE_STATIC : true
 process.env.VITE_STATIC     : true
 ==================================

========== Layout.astro ==========
 import.meta.env.VITE_STATIC : true
 process.env.VITE_STATIC     : true
 ==================================
 (+6ms)
23:25:46 âœ“ Completed in 11ms.

23:25:46 [build] 1 page(s) built in 910ms
23:25:46 [build] Complete!
```
:::

![](Pasted%20image%2020250423232835.png)

## çµè«–

cloudflare workersã¨ä½µç”¨ã™ã‚‹å ´åˆã¯`import.meta.env.HOGE`ã‚’ä½¿ã†ã»ã†ãŒè‰¯ã„ã€‚

æŠ˜è§’ãªã®ã§ã€ã“ã“ã«ä¹—ã£ã¦ã„ã‚‹å†…ã€ç„¡æ–™ã§è©¦ã›ãã†ãªã‚‚ã®ã‚‚èª¿æŸ»ã—ã‚ˆã†ã¨æ€ã„ã¾ã™ã€‚
[Deploy your Astro Site \| Docs](https://docs.astro.build/en/guides/deploy/)

- å‹•æ©Ÿ
	- astro.configã®ä¸€éƒ¨ã‚’ãƒ“ãƒ«ãƒ‰ç’°å¢ƒã«ã‚ˆã£ã¦åˆ‡ã‚Šæ›¿ãˆãŸã‹ã£ãŸ
	- astroã§ã¯ã„ãã¤ã‹ã®ç’°å¢ƒå¤‰æ•°ã‚’æ‰±ã†æ–¹æ³•ãŒã‚ã‚‹ãŒã€å…¨ã¦ãŒæœ‰åŠ¹ãªã‚ã‘ã§ã¯ãªã‹ã£ãŸã®ã§èª¿æŸ»ã—ãŸ
- çµè«–
	- pnpm i -D viteã—ã¦import.mrta.env.HOGEã‚’ä½¿ã£ã¦ãŠã‘ã°ã„ã„
- ã‚„ã£ãŸã“ã¨
	- cloudflare@latestçµŒç”±ã§astroã‚’ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—
	- process.env.Hogeã‚’ä½¿ã†ãŸã‚ã«@node/typesã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
	- import.meta.env.HOGEã€Œä½¿ã†ãŸã‚ã«viteã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
	- ç’°å¢ƒå¤‰æ•°ã‚’è¨­å®š
		- ç’°å¢ƒå¤‰æ•°ã®æ¥é ­èªã¨ã—ã¦VITE_ã‚’ã¤ã‘ã‚‹
		- ãƒ­ãƒ¼ã‚«ãƒ«
			- .envãƒ•ã‚¡ã‚¤ãƒ«
		- cloudflare
			- .envã¨åŒã˜å†…å®¹ã‚’ãƒ“ãƒ«ãƒ‰å¤‰æ•°ã«æ›¸ãè¾¼ã‚€
	- astro.configã¨*.astroã§æœ‰åŠ¹ãªç’°å¢ƒå¤‰æ•°ã®å‘¼ã³å‡ºã—ã‚’ç¢ºã‹ã‚ã‚‹
		- astrp:envã‚’ä½¿ã†
			- staticãƒ“ãƒ«ãƒ‰ ãƒ­ãƒ¼ã‚«ãƒ«
				- astro.configå†…
					- ã‚¨ãƒ©ãƒ¼
				- .astroå†…
					- æœ‰åŠ¹
			- serverãƒ“ãƒ«ãƒ‰ cloudflare
				- astro.configå†…
					- ã‚¨ãƒ©ãƒ¼
				- .astroå†…
					- ã‚¨ãƒ©ãƒ¼
		- process.env
			- staticãƒ“ãƒ«ãƒ‰ ãƒ­ãƒ¼ã‚«ãƒ«
				- astro.configå†…
					- undefined
				- .astroå†…
					- æœ‰åŠ¹
			- serverãƒ“ãƒ«ãƒ‰ cloudflare
				- astro.configå†…
					- æœ‰åŠ¹
				- .astroå†…
					- æœ‰åŠ¹
		- impoer.meta.env
			- staticãƒ“ãƒ«ãƒ‰ ãƒ­ãƒ¼ã‚«ãƒ«
				- undefined
			- serverãƒ“ãƒ«ãƒ‰ Cloudflare
				- æœ‰åŠ¹




